<!DOCTYPE html>
<html lang="de">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>TimeTracker PRO</title>
    <link rel="stylesheet" href="styles.css">
</head>
<body>

    <div class="sidebar-overlay" onclick="toggleSidebar()"></div>
    
    <nav class="sidebar" id="sidebar">
        <div class="brand">
            TIME.PRO
        </div>
        
        <div class="nav-item active" id="nav-dashboard" onclick="switchTab('dashboard')">
            <span>üìä</span> Dashboard
        </div>
        <div class="nav-item" id="nav-performance" onclick="switchTab('performance')">
            <span>üìà</span> Performance Analyse
        </div>
        <div class="nav-item" id="nav-ihk" onclick="switchTab('ihk')">
            <span>üéì</span> IHK / Karriere
        </div>
        <div class="nav-item" id="nav-school" onclick="switchTab('school')">
            <span>üè´</span> Berufsschule
        </div>
        <div class="nav-item" id="nav-goals" onclick="switchTab('goals')">
            <span>üèÜ</span> Ziele & Fokus
        </div>
        <div class="nav-item" id="nav-history" onclick="switchTab('history')">
            <span>üîé</span> Analyse & Historie
        </div>
        
        <div class="nav-section">Verwaltung</div>
        <div class="nav-item" onclick="openSettings()">
            <span>‚öôÔ∏è</span> Einstellungen
        </div>
        <div class="nav-item" onclick="exportData('json')">
            <span>üíæ</span> Backup
        </div>
        <div class="nav-item" onclick="document.getElementById('fileImp').click()">
            <span>üìÇ</span> Import
        </div>
        <input type="file" id="fileImp" hidden onchange="importData(event)">
    </nav>

    <main class="main" id="mainContent">
        
        <button id="mobileMenuToggle" onclick="toggleSidebar()">‚ò∞</button>
        
        <header class="header">
            <div>
                <div class="greeting" id="userGreeting">Willkommen</div>
                <h1 class="page-title">√úbersicht</h1>
            </div>
            <div class="date-badge" id="currentDate">loading...</div>
        </header>

        <div id="view-dashboard" class="view-section active">
            
            <div class="kpi-grid">
                <div class="card kpi-card" onclick="openCorrection('week')">
                    <div class="progress-ring">
                        <svg width="100" height="100">
                            <circle class="ring-bg" cx="50" cy="50" r="44"></circle>
                            <circle id="ringWeek" class="ring-val" cx="50" cy="50" r="44" stroke-dasharray="276" stroke-dashoffset="276"></circle>
                        </svg>
                        <div class="ring-center">
                            <div class="ring-num" id="valWeek">0</div>
                            <div class="ring-lbl">Woche</div>
                        </div>
                    </div>
                </div>
                <div class="card kpi-card" onclick="openCorrection('month')">
                    <div class="progress-ring">
                        <svg width="100" height="100">
                            <circle class="ring-bg" cx="50" cy="50" r="44"></circle>
                            <circle id="ringMonth" class="ring-val" cx="50" cy="50" r="44" stroke-dasharray="276" stroke-dashoffset="276"></circle>
                        </svg>
                        <div class="ring-center">
                            <div class="ring-num" id="valMonth">0</div>
                            <div class="ring-lbl">Monat</div>
                        </div>
                    </div>
                </div>
                <div class="card" style="display:flex; flex-direction:column; justify-content:center;">
                    <div class="ring-lbl">GLEITZEIT KONTO</div>
                    <div style="font-size:2.8rem; font-weight:800; color:var(--primary); margin:10px 0; font-family:var(--font-mono); letter-spacing:-2px;" id="valTotal">+0.0h</div>
                    <div style="font-size:0.8rem; color:var(--text-muted);">Prognose: <span id="valProjected" style="color:#fff">0h</span></div>
                </div>
                <div class="card" style="display:flex; flex-direction:column; justify-content:center;">
                    <div class="ring-lbl">√ò T√ÑGLICH</div>
                    <div style="font-size:2rem; font-weight:800; color:#fff; margin:5px 0; font-family:var(--font-mono);" id="valAvg">0.0h</div>
                    <div style="margin-top:auto; width:100%;">
                        <div class="ring-lbl" style="margin-bottom:5px; display:flex; justify-content:space-between;">
                            <span>Urlaubstage</span>
                            <span id="valVacationUsed">0 / 30</span>
                        </div>
                        <div style="height:4px; background:rgba(255,255,255,0.1); border-radius:2px;"><div id="vacationProgressBar" style="width:0%; background:var(--success); height:100%;"></div></div>
                    </div>
                </div>
            </div>
            
            <div class="quick-actions">
                <button onclick="openCorrection('month')">¬± Saldo korrigieren</button>
                <button onclick="openSettings()">‚öôÔ∏è Einstellungen</button>
                <button onclick="checkAndBookHolidays()">üèñÔ∏è Feiertage pr√ºfen</button>
            </div>
            
            <div class="audit-grid">
                <div class="card audit-card" id="auditHoliday">
                    <div class="audit-label">Feiertag Check</div>
                    <div class="audit-value" style="color:var(--holiday);" id="auditHolidayValue">Wird geladen...</div>
                </div>
                <div class="card audit-card" id="auditShift">
                    <div class="audit-label">Letzte Schichtwarnung</div>
                    <div class="audit-value" id="auditShiftValue">Keine Warnung</div>
                </div>
                <div class="card audit-card success" id="auditSave">
                    <div class="audit-label">Letzter Autosave</div>
                    <div class="audit-value" id="auditSaveValue">Vor Sekunden</div>
                </div>
            </div>
            <div class="charts-row">
                <div class="card">
                    <div class="chart-header">
                        <div>
                            <div class="chart-title">Saldo Trend</div>
                            <div class="chart-sub">Entwicklung der letzten 30 Tage</div>
                        </div>
                    </div>
                    <div class="trend-container" id="trendChart">
                        </div>
                </div>

                <div class="card">
                    <div class="chart-header">
                        <div class="chart-title">Verteilung</div>
                    </div>
                    <div class="donut-container">
                        <svg width="150" height="150" viewBox="0 0 100 100" style="transform: rotate(-90deg);">
                            <circle cx="50" cy="50" r="40" fill="transparent" stroke="rgba(255,255,255,0.05)" stroke-width="12"></circle>
                            <circle id="donutSick" cx="50" cy="50" r="40" fill="transparent" stroke="var(--danger)" stroke-width="12" stroke-dasharray="0 251"></circle>
                            <circle id="donutVac" cx="50" cy="50" r="40" fill="transparent" stroke="var(--success)" stroke-width="12" stroke-dasharray="0 251"></circle>
                            <circle id="donutSchool" cx="50" cy="50" r="40" fill="transparent" stroke="var(--school)" stroke-width="12" stroke-dasharray="0 251"></circle>
                            <circle id="donutHoliday" cx="50" cy="50" r="40" fill="transparent" stroke="var(--holiday)" stroke-width="12" stroke-dasharray="0 251"></circle>
                            <circle id="donutWork" cx="50" cy="50" r="40" fill="transparent" stroke="var(--primary)" stroke-width="12" stroke-dasharray="0 251"></circle>
                        </svg>
                    </div>
                    <div class="donut-legend">
                        <div class="legend-item"><div class="dot" style="background:var(--primary)"></div> Arbeit</div>
                        <div class="legend-item"><div class="dot" style="background:var(--school)"></div> Schule</div>
                        <div class="legend-item"><div class="dot" style="background:var(--success)"></div> Urlaub</div>
                        <div class="legend-item"><div class="dot" style="background:var(--danger)"></div> Krank</div>
                        <div class="legend-item"><div class="dot" style="background:var(--holiday)"></div> Feiertag</div>
                    </div>
                </div>
            </div>

            <div class="card input-wrapper">
                <div style="display:flex; flex-direction:column; gap:1.25rem;">
                    <h3 style="font-size:1.1rem;">Eintrag erfassen</h3>
                    <div style="display:flex; gap:15px;">
                        <input type="date" id="inpDate" class="glass-input">
                        <select id="inpType" class="glass-select" onchange="toggleTimeInputs()">
                            <option value="work">üíº Arbeit</option>
                            <option value="school">üìö Berufsschule</option>
                            <option value="vacation">üå¥ Urlaub</option>
                            <option value="sick">üíä Krank</option>
                        </select>
                    </div>
                    <div style="display:flex; gap:15px;">
                        <div style="flex:1;">
                            <input type="time" id="inpStart" class="glass-input" placeholder="Start" oninput="toggleTimeInputs()">
                            <span class="time-prediction" id="startPrediction"></span>
                        </div>
                        <input type="time" id="inpEnd" class="glass-input" placeholder="Ende">
                    </div>
                    <input type="number" id="inpHours" class="glass-input" step="0.25" placeholder="Stunden manuell...">
                    
                    <div style="display:flex; gap:15px; margin-top:auto;">
                        <button id="mainBtn" class="btn btn-primary" onclick="handleEntry()">Eintrag speichern</button>
                        <button id="cancelBtn" class="btn" style="background:#222; display:none; flex:1;" onclick="resetEdit()">Abbrechen</button>
                    </div>
                </div>

                <div class="timer-box" id="timerBox">
                    <span style="color:var(--text-muted); font-size:0.8rem; text-transform:uppercase; letter-spacing:1px;">Live Tracker</span>
                    <div class="timer-display" id="timerDisplay">00:00:00</div>
                    
                    <div class="timer-log">
                        <div class="timer-log-status" id="timerStatus">STOP</div>
                        <div class="timer-log-bar" id="timerLogBar">
                            </div>
                    </div>
                    
                    <div class="btn-icon-row">
                        <button class="btn btn-ghost" onclick="timerAction('start')" style="color:var(--success)">‚ñ∂ Start</button>
                        <button class="btn btn-ghost" onclick="timerAction('pause')" style="color:#fbbf24">II Pause</button>
                        <button class="btn btn-ghost" onclick="timerAction('stop')" style="color:var(--danger)">‚ñ† Stop</button>
                    </div>
                </div>
            </div>

            <div class="card">
                <div class="list-header">Letzte Aktivit√§ten</div>
                <div id="entryListShort"></div>
            </div>
        </div>

        <div id="view-performance" class="view-section">
            <div class="kpi-grid" style="grid-template-columns: 1fr 1fr 1fr;">
                <div class="card kpi-large">
                    <div class="kpi-large-label">Soll-Erf√ºllungsgrad (90 Tage)</div>
                    <div class="kpi-large-value" id="kpiPerformance">0%</div>
                    <div style="font-size:0.8rem; color:var(--text-muted);">Ziel: 100%</div>
                </div>
                <div class="card kpi-large">
                    <div class="kpi-large-label">√ò Saldo Monatlich (1 Jahr)</div>
                    <div class="kpi-large-value" id="kpiAvgMonthlyDiff" style="color:var(--primary);">+0h</div>
                    <div style="font-size:0.8rem; color:var(--text-muted);">Zeigt den monatlichen Trend</div>
                </div>
                <div class="card kpi-large">
                    <div class="kpi-large-label">Gesamt Sollstunden (90 Tage)</div>
                    <div class="kpi-large-value" id="kpiExpected90" style="color:#fff;">0h</div>
                    <div style="font-size:0.8rem; color:var(--text-muted);">Zum Vergleich</div>
                </div>
            </div>

            <div class="charts-row" style="grid-template-columns: 1fr;">
                <div class="card">
                    <div class="chart-header">
                        <div>
                            <div class="chart-title">W√∂chentlicher Soll-Ist-Vergleich</div>
                            <div class="chart-sub">Deine geleistete Zeit vs. Soll-Zeit der letzten 8 Wochen</div>
                        </div>
                        <div class="donut-legend">
                            <div class="legend-item"><div class="dot" style="background:var(--work-color)"></div> Geleistet</div>
                            <div class="legend-item"><div class="dot" style="background:var(--expected-color)"></div> Soll</div>
                        </div>
                    </div>
                    <div class="chart-container" id="chartWeeklyPerformance">
                        </div>
                </div>
            </div>

            <div class="charts-row" style="grid-template-columns: 1fr;">
                 <div class="card chart-deep-row">
                     <div style="padding-right: 1.5rem; border-right: 1px solid var(--border);">
                        <div class="chart-header">
                            <div>
                                <div class="chart-title">√ò Produktivit√§t pro Wochentag</div>
                                <div class="chart-sub">Durchschnittlicher Saldo Mo - Fr</div>
                            </div>
                        </div>
                        <div class="chart-container" id="chartProductivityByDay" style="height: 200px;">
                            </div>
                    </div>
                     
                    <div style="padding-left: 1.5rem;">
                         <div class="chart-header">
                            <div>
                                <div class="chart-title">Tages-Heatmap</div>
                                <div class="chart-sub">Durchschnittliche geleistete Zeit pro Stunde (8:00 - 23:00)</div>
                            </div>
                        </div>
                        <div id="chartProductivityHeatmap">
                            </div>
                    </div>
                </div>
            </div>

            <div class="charts-row" style="grid-template-columns: 1fr;">
                 <div class="card">
                    <div class="chart-header">
                        <div>
                            <div class="chart-title">Saldo-Entwicklung pro Monat</div>
                            <div class="chart-sub">Kumulierte Saldo-Ver√§nderung pro Monat (12 Monate)</div>
                        </div>
                    </div>
                    <div class="trend-container" id="chartMonthlyTrend">
                        </div>
                </div>
            </div>
        </div>

        <div id="view-ihk" class="view-section">
            <h2 style="margin-bottom:1.5rem; color:var(--ihk);">üéì Karriere & Ausbildungs-Audit</h2>
            
            <div class="kpi-grid" style="grid-template-columns: 1.5fr 1fr 1fr;">
                <div class="card ihk-progress-card">
                    <div class="ihk-kpi-label">AUSBILDUNGSFORTSCHRITT</div>
                    <div class="ihk-kpi-value" id="ihkProgress">0%</div>
                    <div class="progress-bar-ihk" style="width: 80%;">
                        <div class="progress-ihk" id="ihkProgressBar" style="width: 0%;"></div>
                    </div>
                    <div style="font-size: 0.9rem; color: var(--text-muted); margin-top: 10px;">
                        <span id="ihkStartEndDates">Start/Ende fehlen</span>
                    </div>
                </div>

                <div class="card" style="display:flex; flex-direction:column; justify-content:space-around; gap:10px;">
                    <div class="ihk-secondary-kpi" style="border-left-color: var(--danger);">
                        <div class="ihk-metric-label">TAGE BIS ABSCHLUSSPR√úFUNG</div>
                        <div class="ihk-metric-value" id="ihkCountdownEndAudit">---</div>
                        <div class="ihk-metric-label" style="font-size:0.7rem;">Ende: <span id="ihkExamDateEnd">Datum fehlt</span></div>
                    </div>
                    <div class="ihk-secondary-kpi" style="border-left-color: var(--school);">
                        <div class="ihk-metric-label">TAGE BIS ZWISCHENPR√úFUNG</div>
                        <div class="ihk-metric-value" id="ihkCountdownZwischen">---</div>
                        <div class="ihk-metric-label" style="font-size:0.7rem;">Datum: <span id="ihkExamDateZwischen">Datum fehlt</span></div>
                    </div>
                </div>
                
                <div class="card" style="display:flex; flex-direction:column; justify-content:space-around; gap:10px;">
                     <div class="ihk-secondary-kpi" style="border-left-color: var(--ihk);">
                        <div class="ihk-metric-label">SOLL-STUNDEN (GESAMT)</div>
                        <div class="ihk-metric-value" id="ihkTotalExpectedHours">0h</div>
                        <div class="ihk-metric-label" style="font-size:0.7rem;">Erwartete Soll-Zeit bis Ende</div>
                    </div>
                    <div class="ihk-secondary-kpi">
                        <div class="ihk-metric-label">FEHLZEIT WARNUNG</div>
                        <div class="ihk-metric-value" id="ihkMissedTimeWarning" style="font-size:1.5rem;">Daten fehlen</div>
                        <div class="ihk-metric-label" style="font-size:0.7rem;">√ò Fehltage in % der Laufzeit</div>
                    </div>
                </div>
            </div>
            
            <div class="card" style="margin-bottom: 2rem;">
                <div class="kpi-grid" style="grid-template-columns: 1fr 1fr;">
                    <div class="ihk-secondary-kpi" style="border-left-color: var(--danger);">
                        <div class="ihk-metric-label">Kumulierte Krankheitstage</div>
                        <div class="ihk-metric-value" id="ihkSickDays">0</div>
                    </div>
                     <div class="ihk-secondary-kpi" style="border-left-color: var(--school);">
                        <div class="ihk-metric-label">Kumulierte Berufsschultage</div>
                        <div class="ihk-metric-value" id="ihkSchoolDays">0</div>
                    </div>
                </div>
            </div>

            <div class="card">
                <h3 style="margin-bottom:1.5rem;">IHK Ausbildungsdaten pflegen</h3>
                
                <div class="ihk-input-group">
                    <div style="flex:1;">
                        <label style="font-size:0.7rem; color:var(--text-muted); display:block; margin-bottom:5px;">Ausbildungs-Startdatum:</label>
                        <input type="date" id="confIHKStart" class="glass-input">
                    </div>
                    <div style="flex:1;">
                        <label style="font-size:0.7rem; color:var(--text-muted); display:block; margin-bottom:5px;">Erwartetes Ausbildungs-Ende (Abschlusspr√ºfung):</label>
                        <input type="date" id="confIHKEnd" class="glass-input">
                    </div>
                </div>
                
                <h4 style="color:var(--text-muted); margin-bottom:10px; font-size:0.8rem;">PR√úFUNGSDATEN & NOTEN</h4>
                <div class="ihk-input-group">
                    <div style="flex:1;">
                        <label style="font-size:0.7rem; color:var(--text-muted); display:block; margin-bottom:5px;">Datum der Zwischenpr√ºfung:</label>
                        <input type="date" id="confIHKExamZwischen" class="glass-input">
                    </div>
                    <div style="flex:1;">
                        <label style="font-size:0.7rem; color:var(--text-muted); display:block; margin-bottom:5px;">Note Zwischenpr√ºfung (1.0 - 6.0):</label>
                         <input type="number" id="confIHKNoteZwischen" class="glass-input" step="0.1" placeholder="Note (z.B. 2.7)">
                    </div>
                </div>
                 <div class="ihk-input-group">
                    <div style="flex:1;">
                        <label style="font-size:0.7rem; color:var(--text-muted); display:block; margin-bottom:5px;">Datum der Abschlusspr√ºfung:</label>
                        <input type="date" id="confIHKExamAbschluss" class="glass-input" disabled style="background:#151518; color:#777;">
                        <span style="font-size:0.7rem; color:var(--text-muted);">Wird vom Ausbildungs-Ende √ºbernommen</span>
                    </div>
                    <div style="flex:1;">
                        <label style="font-size:0.7rem; color:var(--text-muted); display:block; margin-bottom:5px;">Note Abschlusspr√ºfung (1.0 - 6.0):</label>
                         <input type="number" id="confIHKNoteAbschluss" class="glass-input" step="0.1" placeholder="Note (z.B. 1.3)">
                    </div>
                </div>
                
                <div style="display:flex; justify-content:flex-end; margin-top: 1.5rem;">
                     <button class="btn btn-primary" onclick="saveIHKSettings()" style="width: 300px;">Daten speichern & berechnen</button>
                </div>
            </div>
            
            <div class="card">
                <h4 style="margin-bottom:10px;">Noten- & Countdown-√úbersicht</h4>
                <div class="ihk-note-group">
                    <div class="ihk-secondary-kpi card" style="border-left: 3px solid var(--ihk);">
                        <div class="ihk-metric-label">Zwischenpr√ºfung Note:</div>
                        <div class="ihk-note-value" id="ihkDisplayNoteZwischen">---</div>
                    </div>
                    <div class="ihk-secondary-kpi card" style="border-left: 3px solid var(--ihk);">
                        <div class="ihk-metric-label">Abschlusspr√ºfung Note:</div>
                        <div class="ihk-note-value" id="ihkDisplayNoteAbschluss">---</div>
                    </div>
                </div>
            </div>
        </div>
        
        <div id="view-school" class="view-section">
            <div class="kpi-grid" style="grid-template-columns: 1.5fr 1fr 1fr;">
                <div class="ihk-exam-kpi card" id="kpiOverallAvg">
                    <div class="ihk-kpi-label">AKTUELLER GESAMT-DURCHSCHNITT</div>
                    <div class="school-kpi-note" id="schoolOverallAvg">1.0</div>
                    <div class="school-kpi-sub" style="margin-top:10px;">(Alle Noten, gewichtet 1:1)</div>
                </div>
                <div class="ihk-exam-kpi card" id="kpiBestNote">
                    <div class="ihk-kpi-label">BESTE NOTE</div>
                    <div class="school-kpi-note" id="schoolBestNote">---</div>
                    <div class="school-kpi-sub" id="schoolBestSubject"></div>
                </div>
                 <div class="ihk-exam-kpi card" id="kpiWorstNote">
                    <div class="ihk-kpi-label">SCHLECHTESTE NOTE</div>
                    <div class="school-kpi-note" id="schoolWorstNote">---</div>
                    <div class="school-kpi-sub" id="schoolWorstSubject"></div>
                </div>
            </div>

            <div class="card">
                <h3 style="margin-bottom:1.5rem; color:var(--school);">Berufsschul-Notenverwaltung</h3>
                <h4 style="color:var(--text-muted); margin-bottom:10px; font-size:0.8rem;">F√ÑCHER UND BEWERTUNGEN</h4>
                
                <div id="schoolGradesInputGrid" style="display:grid; grid-template-columns: repeat(2, 1fr); gap:15px;">
                    <div style="grid-column: 1 / -1; display:flex; justify-content:flex-end; margin-top:1rem;">
                        <button class="btn btn-primary" onclick="saveSchoolGrades()" style="width: 300px; background:var(--school);">Noten speichern & berechnen</button>
                    </div>
                </div>
                
            </div>
             <div class="card">
                <h4 style="margin-bottom:10px;">Noten-Historie (Alle eingetragenen Noten)</h4>
                <div id="schoolGradesList" style="display:grid; grid-template-columns: repeat(auto-fit, minmax(200px, 1fr)); gap:15px;">
                    </div>
             </div>
        </div>
        
        <div id="view-goals" class="view-section">
            <h2 style="margin-bottom:1.5rem;">üèÜ Ziele & Troph√§en</h2>
            <p style="color:var(--text-muted); margin-bottom:2rem;">Verfolge deine Langzeit-Ziele und definiere eigene Meilensteine.</p>

            <h4 style="color:var(--text-muted); margin-bottom:10px; font-size:0.8rem;">ZIEL DEFINITION & ERSTELLUNG</h4>
            <div class="card" style="margin-bottom: 2rem;">
                <div style="display:grid; grid-template-columns: 1fr 1fr 1fr; gap:15px;">
                    <input type="text" id="goalTitle" class="glass-input" placeholder="Zielname (z.B. 100h √úberstunden)">
                    
                    <select id="goalType" class="glass-select">
                        <option value="TOTAL_WORKED_HOURS">Gesamt Gearbeitet (h)</option>
                        <option value="TOTAL_DIFF_HOURS">Gesamt Saldo (h)</option>
                        <option value="POSITIVE_WEEKS">Wochen im Plus (Anzahl)</option>
                        <option value="PERFECT_SHIFTS">Schichten mit Diff < 0.1 (Anzahl)</option>
                    </select>

                    <input type="number" id="goalTarget" class="glass-input" placeholder="Zielwert (z.B. 100)">
                </div>
                <div style="display:flex; justify-content:flex-end; margin-top:15px;">
                    <button class="btn btn-primary" onclick="addCustomGoal()" style="width: 300px;">Ziel hinzuf√ºgen</button>
                </div>
            </div>

            <h4 style="color:var(--text-muted); margin-bottom:10px; font-size:0.8rem;">AKTIVE ZIELE</h4>
            <div class="goal-grid" id="goalsList">
                </div>

            <h4 style="color:var(--text-muted); margin-bottom:10px; font-size:0.8rem; margin-top: 3rem;">FREIGESCHALTETE TROPH√ÑEN (PLATZHALTER)</h4>
            <div class="goal-grid" id="trophiesList" style="grid-template-columns: repeat(auto-fit, minmax(180px, 1fr));">
                 <div class="goal-card" style="border-left-color: #ffd700;">
                    <div style="font-size: 2rem;">üëë</div>
                    <div class="goal-title">Marathon-Start</div>
                    <div class="goal-status" style="color: #ffd700;">(50h erreicht)</div>
                </div>
                 <div class="goal-card" style="border-left-color: #c0c0c0; opacity: 0.5;">
                    <div style="font-size: 2rem;">üèÖ</div>
                    <div class="goal-title">Perfektionist</div>
                    <div class="goal-status">Noch nicht erreicht</div>
                </div>
            </div>
        </div>

        <div id="view-history" class="view-section">
            <div class="card">
                <div class="filter-header">
                    <h2 style="font-size:1.5rem;">Daten-Analyse & Historie</h2>
                    <span id="historyCount">0 Eintr√§ge</span>
                </div>
                
                <div class="filter-grid">
                    <input type="date" id="historyFilterStart" class="glass-input" placeholder="Startdatum" onchange="renderHistoryView()">
                    <input type="date" id="historyFilterEnd" class="glass-input" placeholder="Enddatum" onchange="renderHistoryView()">

                    <select id="historyFilterType" class="glass-select" onchange="renderHistoryView()">
                        <option value="all">Alle Typen</option>
                        <option value="work">üíº Arbeit</option>
                        <option value="school">üìö Berufsschule</option>
                        <option value="vacation">üå¥ Urlaub</option>
                        <option value="sick">üíä Krank</option>
                        <option value="holiday">üèñÔ∏è Feiertag</option>
                    </select>

                    <input type="number" id="historyFilterMinHours" class="glass-input" step="0.5" placeholder="Min. Stunden" oninput="renderHistoryView()">
                    
                    <input type="text" id="historyFilterSearch" class="glass-input" placeholder="Suche (Info/Projekt)" oninput="renderHistoryView()" style="grid-column: 1 / span 4;">
                </div>

                <div style="display:flex; gap:15px; margin-bottom: 1.5rem;">
                    <button class="btn btn-primary" onclick="exportHistoryData('csv')" style="flex:1;">CSV Export (Gefiltert)</button>
                    <button class="btn btn-primary" onclick="exportHistoryData('json')" style="flex:1; background:var(--school);">JSON Export (Gefiltert)</button>
                </div>

                <div id="entryListFull">
                    <p style="color:var(--text-muted); text-align:center;">Lade Historie...</p>
                </div>
            </div>
        </div>


    </main>

    <div class="modal" id="settingsModal">
        <div class="modal-box">
            <div style="display:flex; justify-content:space-between; margin-bottom:2rem;">
                <h2>Einstellungen</h2>
                <button onclick="closeSettings()" style="background:none; border:none; color:#fff; font-size:1.5rem; cursor:pointer;">&times;</button>
            </div>
            
            <h4 style="color:var(--text-muted); margin-bottom:10px; font-size:0.8rem;">PROFIL & Design</h4>
            <input type="text" id="confName" class="glass-input" style="margin-bottom:1.5rem;" placeholder="Dein Name">

            <h4 style="color:var(--text-muted); margin-bottom:10px; font-size:0.8rem;">DESIGN ACCENT</h4>
            <div style="display:flex; gap:15px; margin-bottom:2rem;">
                <div class="color-dot" style="background:#a855f7" onclick="setTheme('#a855f7')"></div>
                <div class="color-dot" style="background:#3b82f6" onclick="setTheme('#3b82f6')"></div>
                <div class="color-dot" style="background:#06b6d4" onclick="setTheme('#06b6d4')"></div>
                <div class="color-dot" style="background:#10b981" onclick="setTheme('#10b981')"></div>
                <div class="color-dot" style="background:#f59e0b" onclick="setTheme('#f59e0b')"></div>
                <div class="color-dot" style="background:#ec4899" onclick="setTheme('#ec4899')"></div>
            </div>

            <h4 style="color:var(--text-muted); margin-bottom:10px; font-size:0.8rem;">ARBEITSZEITEN & PAUSE</h4>
            <div style="display:grid; grid-template-columns: 1fr 1fr; gap:15px; margin-bottom:1.5rem;">
                <div>
                    <label style="font-size:0.7rem; color:#666; display:block; margin-bottom:5px;">Ab Stunden (Pause):</label>
                    <input type="number" id="confBreakThresh" class="glass-input" value="6">
                </div>
                <div>
                    <label style="font-size:0.7rem; color:#666; display:block; margin-bottom:5px;">Abzug (Min):</label>
                    <input type="number" id="confBreakMin" class="glass-input" value="30">
                </div>
            </div>

            <h4 style="color:var(--text-muted); margin-bottom:10px; font-size:0.8rem;">SOLL-STUNDEN (MO-FR)</h4>
            <div style="display:grid; grid-template-columns: repeat(5, 1fr); gap:8px; margin-bottom:2rem;">
                <input type="number" id="h1" class="glass-input" style="padding:10px; text-align:center;">
                <input type="number" id="h2" class="glass-input" style="padding:10px; text-align:center;">
                <input type="number" id="h3" class="glass-input" style="padding:10px; text-align:center;">
                <input type="number" id="h4" class="glass-input" style="padding:10px; text-align:center;">
                <input type="number" id="h5" class="glass-input" style="padding:10px; text-align:center;">
            </div>

            <h4 style="color:var(--text-muted); margin-bottom:10px; font-size:0.8rem;">URLAUBSVERWALTUNG</h4>
            <div style="display:flex; gap:15px; margin-bottom:1.5rem;">
                <div style="flex:1;">
                    <label style="font-size:0.7rem; color:#666; display:block; margin-bottom:5px;">Jahresanspruch (Tage):</label>
                    <input type="number" id="confVacationTotal" class="glass-input" value="30">
                </div>
                <div style="flex:1;">
                    <label style="font-size:0.7rem; color:#666; display:block; margin-bottom:5px;">Schon genommene Tage (manuell):</label>
                    <input type="number" id="confVacationUsedManual" class="glass-input" value="0">
                </div>
            </div>
            
            <div style="font-size:0.8rem; color:var(--text-muted); margin-bottom:1.5rem;">
                <p>Aktueller, anteiliger Urlaubsanspruch (basierend auf IHK-Start): <strong id="vacationProRata" style="color:var(--success);">0</strong> Tage</p>
                <p>Der Wert oben ('Jahresanspruch') wird automatisch auf diesen Wert gesetzt, wenn du die Einstellungen speicherst.</p>
            </div>

            <div class="vacation-grid">
                <div style="text-align:center; padding:10px 0;">
                    <div style="font-size:3rem; font-weight:800; color:var(--success);" id="vacationRemaining">0</div>
                    <div style="font-size:0.8rem; color:var(--text-muted); text-transform:uppercase;">Verf√ºgbar (Tage)</div>
                </div>

                <div class="vacation-block-tool">
                    <h5 style="margin-bottom:10px;">Blockbuchung verwalten</h5>
                    <select id="periodType" class="glass-select" style="margin-bottom:10px;">
                        <option value="vacation">üå¥ Urlaub buchen</option>
                        <option value="holiday">üèñÔ∏è Firmen-Frei/Feiertag buchen</option>
                    </select>
                    <div style="display:grid; grid-template-columns: 1fr 1fr; gap:10px; margin-bottom:10px;">
                        <input type="date" id="periodStart" class="glass-input" placeholder="Startdatum">
                        <input type="date" id="periodEnd" class="glass-input" placeholder="Enddatum">
                    </div>
                    <button class="btn btn-primary" onclick="bookPeriod()">Tage buchen & √ºberschreiben</button>
                    <button class="btn btn-danger" onclick="deletePeriod()" style="margin-top:10px; background:var(--danger);">Perioden-Buchungen l√∂schen</button>
                </div>
            </div>


            <button class="btn btn-primary" onclick="saveSettings()" style="margin-top:2rem;">Einstellungen speichern</button>
        </div>
    </div>

    <div class="modal" id="corrModal">
        <div class="modal-box" style="width:400px;">
            <h3>Korrektur buchen</h3>
            <p style="color:var(--text-muted); margin-bottom:1.5rem; font-size:0.9rem;">Manuelle Buchung auf das Gleitzeitkonto.</p>
            <select id="corrSelect" class="glass-select" style="margin-bottom:15px;"></select>
            <input type="number" id="corrVal" class="glass-input" placeholder="Stunden (+/-)" step="0.1" style="margin-bottom:2rem;">
            <button class="btn btn-primary" onclick="saveCorrection()">Buchen</button>
            <button class="btn" style="width:100%; margin-top:10px; background:transparent; border:1px solid var(--border);" onclick="document.getElementById('corrModal').classList.remove('active')">Abbrechen</button>
        </div>
    </div>

    <!-- Edit Entry Modal -->
    <div class="modal" id="editEntryModal">
        <div class="modal-box" style="width:480px;">
            <div style="display:flex; justify-content:space-between; align-items:center; margin-bottom:1rem;">
                <h3>Eintrag bearbeiten</h3>
                <button onclick="closeEditModal()" style="background:none; border:none; color:#fff; font-size:1.25rem; cursor:pointer;">&times;</button>
            </div>

            <div style="display:grid; gap:12px;">
                <input type="date" id="edit_inpDate" class="glass-input">
                <select id="edit_inpType" class="glass-select">
                    <option value="work">üíº Arbeit</option>
                    <option value="school">üìö Berufsschule</option>
                    <option value="vacation">üå¥ Urlaub</option>
                    <option value="sick">üíä Krank</option>
                </select>

                <div style="display:flex; gap:10px;">
                    <input type="time" id="edit_inpStart" class="glass-input" placeholder="Start">
                    <input type="time" id="edit_inpEnd" class="glass-input" placeholder="Ende">
                </div>
                <input type="number" id="edit_inpHours" class="glass-input" step="0.25" placeholder="Stunden manuell...">

                <div style="display:flex; gap:10px; justify-content:flex-end; margin-top:6px;">
                    <button class="btn" onclick="closeEditModal()">Abbrechen</button>
                    <button class="btn btn-primary" onclick="saveEditModal()">√Ñnderungen speichern</button>
                </div>
            </div>
        </div>
    </div>

    <script src="chart.js"></script> 
    <script src="features.js"></script> 
    <script src="core.js"></script>
</body>
</html>